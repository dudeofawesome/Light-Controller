language: android
android:
  components:
    - platform-tools
    - tools
    - build-tools-24.0.3
    - android-24
    - extra-google-google_play_services
    - extra-android-support
    - extra-android-m2repository
    - sys-img-armeabi-v7a-android-24
  licenses:
    - android-sdk-license-.+
jdk:
  - oraclejdk8

sudo: false


before_script:
  - sudo service postgresql stop || true
  - sudo service mysql stop || true
  - sudo service memcached stop || true
  - sudo service bootlogd stop || true
  - sudo service elasticsearch stop || true
  - sudo service mongodb stop || true
  - sudo service neo4j stop || true
  - sudo service cassandra stop || true
  - sudo service riak stop || true
  - sudo service rsync stop || true
  - sudo service x11-common stop || true

#  - echo no | android create avd --force -n test -t android-24 --abi armeabi-v7a
#  - emulator -avd test -no-skin -no-audio -no-window &
#  - android-wait-for-emulator
#  - adb shell input keyevent 82 &

before_cache:
  - rm -f $HOME/.gradle/caches/modules-2/modules-2.lock

cache:
  directories:
    - $HOME/.gradle/caches/
    - $HOME/.gradle/wrapper/

before_install:
  - openssl aes-256-cbc -K $encrypted_61ce15ab94e1_key -iv $encrypted_61ce15ab94e1_iv -in signing.jks.enc -out signing.jks -d

deploy:
  provider: releases
  api_key:
    secure: $GITHUB_RELEASE_API_KEY
  file: LC1/build/outputs/apk/LC1-release.apk
  skip_cleanup: true
  on:
    repo: eliotstocker/Light-Controller
    tags: true
